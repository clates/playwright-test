name: Post Worldbuilder Regression
on:
  issue_comment:
    types: [created]

jobs:
  pr_commented:
    # This job only runs for pull request comments
    name: PR comment
    if: ${{ github.event.issue.pull_request }}
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
        # Extract the world from the comment and run the test
        # Integration Test World URL (client-app-ci-pr-8693-24-stage-world): ðŸ‘‰ https://client-app-ci-pr-8693-24-stage-world.crunchbase.io/
      - run: |
          BASE_URL="${EVENT#*ðŸ‘‰ }"
          if [ -z "$BASE_URL" ]
          then
            echo "No world URL found in comment"
            exit 1
          fi
          echo "Comment contained trigger $BASE_URL"
          if [[ $BASE_URL =~ ^https://.*\.crunchbase\.io/$ ]]
          then
            exit 0
          else
            echo "World URL is invalid"
            exit 1
          fi
      - run: |
          echo "Running playwright test"
          npm install
          npm run test:playwright 

        env:
          NUMBER: ${{ github.event.issue.number }}
          EVENT: ${{ github.event.comment.body }}

#   blah:
#     name: Create pull request
#     uses: actions/github-script@v6.4.1
#     with:
#         # github-token: ${{ secrets.CI_GITHUB_TOKEN }}
#         script: |
#             const script = require('./.github/scripts/triggerPlaywright.js');
#             await script(github, context, core);